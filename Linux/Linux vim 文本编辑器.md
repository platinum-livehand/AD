## vim 更新

​	查看 vim 版本

```shell
vim --version
```

​	更新 vim

```shell
sudo add-apt-repository ppa:jonathonf/vim 
sudo apt update
sudo apt upgrade
```

## vimplus 插件

```shell
git clone https://github.com/chxuan/vimplus.git ~/.vimplus
cd ~/.vimplus
./install.sh //不加sudo
```

​	为防止 vimplus 显示乱码，需要设置 linux 终端（远程终端）字体为 `Droid Sans Mono Nerd Font`。

## Vim 的模式

​	在 vim 中一共有三种模式，分别是 **命令模式**、**末行模式**、**编辑模式**，当我们打开 vim 之后默认进入的是命令模式。

1. **命令模式**（Normal Mode）：在该模式下我们可以进行，**查看文件内容**，**修改文件**，**关键字搜索**等操作。
2. **插入模式**（Insert Mode）：在该模式下主要对内容进行修改和内容添加。
4. **末行模式**（Command Mode）：在该模式下可以进行 **执行 Linux 命令**，**保存文件**，**进行行跳转**，**窗口分屏**等操作。

​	**切换任何模式都是在命令模式下进行切换的！！！**

![](..\picture\vim 使用-1.png)

## 命令模式下的操作

​	通过 vim 打开一个文件，如果文件不存在，并且在退出的时候进行了保存，文件就会被创建出来。

```shell
# 打开一个文件
$ vim 文件名
```

### 保存退出

​	直接在键盘上操作，通过键盘按两个连续的大写 `Z`，或者 `shift + z`

```shell
# 先按住 shift 键, 然后连续按两次 z
ZZ
```

### 代码格式化

​	在编程过程中，为了便于阅读和代码维护，代码都需要按照样式对其，如果代码格式凌乱，可以在命令模式下快速进行代码的格式化，让其看起来更加美观，这个操作需要在键盘上连续输入多个字符。

```shell
# 假设写的c/c+代码没有对齐, 通过该命令可以对齐代码
# 一定要注意最后一个字符是 大写的 G, 因此需要先按 shift
gg=G
```

### 光标移动

​	在 vim 中可以使用键盘上的方向键来移动光标，这个操作相对比较复杂，有一种更加简洁的操作方式，就是使用键盘上的 `h`，`j`，`k`，`l`。

```shell
# 标准的移动光标的方法: 使用 h, j, k, l

                                        光标上移   
                                           ↑
                                           |
                     光标左移 <-- h    j    k    l --> 光标右移
                                       |
                                       ↓
                                    光标下移    
```

​	除此之外我们还可以使用一些快捷键实现光标的快速跳转，常用的有：

| 快捷键  |       功能       |                      备注                       |
| :-----: | :--------------: | :---------------------------------------------: |
|    0    |  光标移动到首行  |                       无                        |
|    $    |  光标移动到行尾  |                    shift + 4                    |
|   gg    | 光标移动到文件头 |                  第一行的开始                   |
|    G    | 光标移动到文件尾 |                 最后一行的开始                  |
|   nG    |      行跳转      |             n 代表需要跳转到哪一行              |
| n+Enter |  相对跳转 n 行   | 从光标所在当前行往下跳 n 行，n 对应的是一个整数 |

### 删除命令

​	在 vim 中是没有删除操作的，起始所谓的删除就是剪切，被删除的数据都可以被粘贴到文档的任意位置，即便如此我们还是习惯性的将剪切操作称之为删除，常用的删除操作如下：

|  快捷键   |        功能        |                             备注                             |
| :-------: | :----------------: | :----------------------------------------------------------: |
| x（小写） | 删除光标后边的字符 |              vim 中的光标比较宽会盖住后边的字符              |
| X（大写） | 删除光标前边的字符 |                              无                              |
|    dw     |      删除单词      | 要先把光标移动到单词的第一个字母上再删除，否则单词只能被删除一部分 |
|    d0     | 删除光标前的字符串 |           从字符串开头到光标当前位置的字符串被删除           |
|  d$（D）  | 删除光标后的字符串 |    从光标当前位置到字符串尾部的字符串被删除，使用 D 也行     |
|    dd     |   删除光标所在行   |                              无                              |
|    ndd    |     删除 n 行      |        从光标所在行开始删除 n 行，n 对应的是一个整数         |

### 撤销和反撤销

​	撤销和反撤销对应 windows 中的 `ctrl + z` 和 `ctrl + y`，但是在 vim 中不一样。

|            快捷键            |  功能  |           备注           |
| :--------------------------: | :----: | :----------------------: |
|              u               |  撤销  | 等价于 win 中的 ctrl + z |
| ctrl + R（ctrl + shift + r） | 反撤销 | 等价于 win 中的 ctrl + y |

### 复制和粘贴

| 快捷键 |           功能            |       备注       |
| :----: | :-----------------------: | :--------------: |
|   P    |  粘贴到光标所在行的下边   |      小写 p      |
|   p    |  粘贴到光标所在行的上边   |      大写 P      |
|   yy   |      复制光标所在行       |        无        |
|  nyy   | 从光标所在行向下复制 n 行 | n 是要复制的行数 |

## 可视模式

​	在编辑文件的过程中，有时候需要删除或者复制的数据不整行，而是一行中的某一部分，这时候可以使用可视模式进行文本的选择，之后再通过相关的快捷键对所选中的数据块进行复制或删除操作。

- `v`：进入字符可视化模式（Characterwise visual mode），文本选择是以字符为单位的。
- `V`：进入行可视化模式（Linewise visual mode），文本选择是以行为单位的。
- `ctrl + v`：进入的块可视化模式（Blockwise visual mode），可以选择一个矩形内的文本。

​	进入可视模式之后，就可以进行文本块的选择和复制以及删除了

|  快捷键   |         功能         |
| :-------: | :------------------: |
|     h     |     光标向左移动     |
|     j     |     光标向下移动     |
|     k     |     光标向上移动     |
|     l     |     光标向右移动     |
|     d     |     删除（剪切）     |
|     y     |         复制         |
| p（小写） | 粘贴数据到光标的后边 |
| P（大写） | 粘贴数据到光标的前边 |

### 字符可视模式

​	控制光标方向用来选择文件中的不规则数据块，可以对选中的文本信息进行复制和删除。

```shell
# 进入到字符可视模式，直接在键盘上按 v 即可: 
v
```

​	通过 `v` 切换到字符可视模式之后，在窗口的最下方会看到 `-- VISUAL --` 字样。

### 行可视模式

​	向下移动光标可以选择一整行，向上移动光标可以取消整行选择。

```shell
# 进入行可视模式, 键盘上按 shift+v 
V
```

​	通过 V 切换到行可视模式之后，在窗口的最下方会看到 `-- VISUAL LINE --` 字样。

### 块可视模式

​	通过向上，下移动光标控制矩形文本块的高度，通过向左，右移动光标控制矩形文本块的宽度。

```shell
# 进入块可视模式, 选择一个矩形文本块
ctrl + v
```

​	通过 ctrl + v 切换到块可视模式之后，在窗口的最下方会看到 `-- VISUAL BLOCK --` 字样。

### 代码注释

​	代码块注释可以使用块可视模式，具体操作步骤如下：

- 通过 `ctrl + v` 进入块可视模式。
- 光标向上移（k）或者下移（j），选中多个代码行的开头，如下图所示。

![](..\picture\vim 使用-2.png)

- 选择完毕后，按大写的 `I` 键，此时下方会提示进入 insert 模式，输入你要插入的注释符，例如：`//`
- 最后按 ESC 键，你就会发现选中的多行代码已经被注释了。

![](..\picture\vim 使用-3.png)

​	删除多行注释的方法，同样 `ctrl + v` 进入块选择模式，移动光标把要删除的注释符选中，按下 `d` ，注释就被删除了。

## 查找

​	在 vim 的命令模式下一共有三种查找方式，首先需要在键盘上输入对应的字符，然后按回车键 vim 会进行关键字匹配，之后就可以通过 n 或者 N 进行关键字切换了。

| 搜索快捷键 | 关键字遍历 |      描述      |                    备注                    |
| :--------: | :--------: | :------------: | :----------------------------------------: |
|     /      |     n      | 从当前位置向下 |           直接按键盘上的 / 即可            |
|            |     N      | 从当前位置向上 |                                            |
|     ?      |     n      | 从当前位置向上 |                 shift + /                  |
|            |     N      | 从当前位置向下 |                                            |
|     #      |     n      | 从当前位置向上 | 光标需要先放在被搜索的关键字上，键盘上按 # |
|            |     N      |  当前位置向下  |                                            |

- 使用 `/` 或者 `?` 搜索效果一样，只是遍历关键字的时候的顺序是相反的。
- 是用 `#` 必须先从被搜索的文件中找到要搜索的关键字，好处就是搜索的内容不需要通过键盘输入。

## 切换到编辑模式

​	如果要编辑文件，需要从命令模式切换到文件编辑模式，切换模式的快捷键有很多，不同的快捷键对应的效果有所不同，效果如下标所示：

|   快捷键    |                     功能                     |
| :---------: | :------------------------------------------: |
|      i      |              从光标前边开始输入              |
|      a      |              从光标后边开始输入              |
|      o      |       在光标下边创建新行，在新行中输入       |
|      s      | 删除光标后边的字符，从删除的字符位置开始输入 |
| I（大写 i） |             从当前行行首开始输入             |
|      A      |             从当前行行尾开始输入             |
|      O      |       在光标上边创建新行，在新行中输入       |
|      S      |         删除当前行，在当前行开始输入         |

​	文件编辑完成之后，从编辑模式回到命令模式只需要按键盘上的 ESC 即可。

## 末行模式的基本操作

### 命令模式到末行模式

​	从命令模式切换到末行模式只需要在键盘上输入一个 `:`，同时这个符号也会出当前窗口的最下端，这时候我们就可以在最后一行输入我们执行的命令。

```shell
# 命令模式切换到末行模式
在命令模式下键盘输入一个 冒号  -> :

# 从末行模式 -> 命令模式
1. 按两次esc
2. 在末行模式下执行一个完整指令, 执行完毕, 自动回到命令模式
```

![](..\picture\vim 使用-4.png)

​	末行模式切换回命令模式有两种方法：

- 按 `ESC` 键。
- 在末行模式下执行一个完整指令，执行完毕，自动回到命令模式。

### 保存退出

​	使用 vim 对文件编辑完成之后，需要保存或者退出 vim 一般都是在末行模式下完成的，不管是进行哪种操作都有对应的操作指令，如下表：

| 末行模式下输入的命令 |                          功能                          |
| :------------------: | :----------------------------------------------------: |
|         `q`          | 退出，如果退出的时候文件没有保存，vim 会提示是否要保存 |
|         `q!`         |                    强制退出，不保存                    |
|         `w`          |                      保存，不退出                      |
|         `wq`         |                        保存退出                        |
|         `x`          |                        保存退出                        |

### 分屏

​	分屏就是将当前屏幕中的窗口以 水平 或者 垂直 的 方式拆分成多个，在不同的子窗口可以显示同一个文件或者不同文件中的内容。

| 末行命令或者快捷键 |              说明              |               备注               |
| :----------------: | :----------------------------: | :------------------------------: |
|        `sp`        |   水平分屏，多个窗口垂直排列   | 多个窗口中显示同一个文件里的内容 |
|       `vsp`        |   垂直分屏，多个窗口水平排列   | 多个窗口中显示同一个文件里的内容 |
|   `ctrl + w + w`   |    光标在打开的屏幕之间切换    |            快捷键操作            |
|       `qall`       |        同时退出多个屏幕        |                                  |
|       `wqll`       |      同时保存退出多个屏幕      |                                  |
|    `sp 文件名`     | 分屏的同时指定打开的文件的名字 |   在新窗口中显示指定的文件内容   |
|    `vsp 文件名`    | 分屏的同时指定打开的文件的名字 |   在新窗口中显示指定的文件内容   |

​	除了在末行模式下分屏，我们也可以在使用 vim 打开文件的时候直接分屏，下边是需要用到的参数：

- `-o`：水平分屏
- `-O`：垂直分屏

```shell
# 在vim打开文件的时候指定打开多个文件和分屏方式
# 水平分屏
$ vim -o 文件1, 文件2, 文件3 ...
# 垂直分屏
$ vim -O 文件1, 文件2, 文件3 ...
```

### 行跳转

​	在 vim 中不仅可以在命令模式下进行行跳转，也可以在末行模式下进行行跳转，末行模式下指定哪一行光标就可以跳转到哪一行。

```shell
:行号   # 输入完行号之后敲回车
```

### 执行 shell 命令

​	在使用 vim 编辑文件的过程中，还可以在末行模式下执行需要的 shell 命令，在执行 shell 命令之前需要在前边加一个感叹号 `!`。

```shell
# 语法:
:!shell命令

# 举例
:!ls		# 回车即可
```

## vim 配置文件

​	vim 是一个文本编辑器工具，这个工具也是有配置文件的，文件的名字叫做 `vimrc`，在里边可以设置样式，功能，快捷键等属性。对应的配置文件分为两种 `用户级别` 和 `系统级别`。

- 用户级别的配置文件 （`~/.vimrc`）只对当前用户有效。
- 系统级别的配置文件（`/etc/vim/vimrc`）对所有 Linux 用户有效。
- 如果两个配置文件都设置了，用户级别的配置文件起作用（用户级别优先级别高）。